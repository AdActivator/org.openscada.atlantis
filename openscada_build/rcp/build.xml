<?xml version="1.0"?>
<!-- ====================================================================== 
     Aug 24, 2006 11:41:47 AM                                                        

     OpenSCADA RCP Client    
     The OpenSCADA RCP Client
                   
     jens                                                                
     ====================================================================== -->
<project name="OpenSCADA RCP Client" default="default">
    <description>
            The OpenSCADA RCP Client
    </description>
	
	<property file="../config/local.properties"/>

	<property name="eclipse.home" value="/home/user/eclipse"/>
	<property name="eclipse.builder.version" value="_3.4.0.v20080604"/>
	<property name="eclipse.launcher.version" value="_1.0.100.v20080509-1800"/>
	<property name="startup" value="${eclipse.home}/plugins/org.eclipse.equinox.launcher${eclipse.launcher.version}.jar"/>
	
	<property name="buildDirectory" value="${basedir}/eclipse.build"/>
	<property name="configs" value="win32,win32,x86&amp;linux,gtk,x86&amp;linux,gtk,x86_64&amp;macosx,carbon,ppc&amp;solaris,gtk,sparc"/>
	<property name="buildType" value="I"/>
	<property name="buildId" value="AutoBuild"/>
	<property name="version" value="0.0.0"/>
	<property name="release" value="-devel"/>
	<property name="upload.base.ostc" value="${upload.base}/ostc"/>
	<property name="upload.base.pde" value="${upload.base}/pde"/>
	
    <!-- ================================= 
          target: default              
         ================================= -->
    <target name="default" depends="init, package, openscada_pde, win32installer" description="--> The OpenSCADA RCP Client">
        
    </target>
	
	<target name="init">
		<tstamp/>
	</target>
	
	<target name="clean">
		<delete dir="${buildDirectory}"/>
		<delete dir="${upload.base.ostc}"/>
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: openscada_pde                      
         - - - - - - - - - - - - - - - - - -->
    <target name="openscada_pde">
		<java jar="${startup}" failonerror="true" fork="true" dir="${eclipse.home}/plugins/org.eclipse.pde.build${eclipse.builder.version}/scripts" >
			<arg value="-application" />
    		<arg value="org.eclipse.ant.core.antRunner" />
			<arg value="-Dbuilder=${basedir}/openscada"/>
    		<arg value="-DbaseLocation=${eclipse.home}"/>
			<arg value="-DbuildDirectory=${buildDirectory}.pde"/>
       		<arg value="-DbuildType=${buildType}"/>
    		<arg value="-DbuildId=${buildId}"/>
    		<arg value="-Dlibfile=${libfile}"/>
   			<arg value="-Dsource.base=${source.base}"/>
   			<arg value="-Ddeploy.dir=${deploy.dir}"/>
			<arg value="-Ddeploy.dist.module=${deploy.dist.module}"/>
			<arg value="-Dtag=${tag}"/>
    	</java>
    	
    	<!-- copy result to pde upload -->
    	<mkdir dir="${upload.base.pde}"/>
    	<copy todir="${upload.base.pde}">
    		<fileset dir="${buildDirectory}.pde/${buildType}.${buildId}">
    			<include name="*.zip"/>
    		</fileset>
    	</copy>
    </target>


	<!-- - - - - - - - - - - - - - - - - - 
          target: build                      
         - - - - - - - - - - - - - - - - - -->
    <target name="build" depends="clean">
		<java jar="${startup}" failonerror="true" fork="true" dir="${eclipse.home}/plugins/org.eclipse.pde.build${eclipse.builder.version}/scripts" >
			<arg value="-application" />
    		<arg value="org.eclipse.ant.core.antRunner" />
			<arg value="-Dbuilder=${basedir}/ostc"/>
    		<arg value="-DbaseLocation=${eclipse.home}"/>
			<arg value="-DbuildDirectory=${buildDirectory}"/>
       		<arg value="-DbuildType=${buildType}"/>
    		<arg value="-DbuildId=${buildId}"/>
    		<arg value="-Dlibfile=${libfile}"/>
   			<arg value="-Dsource.base=${source.base}"/>
   			<arg value="-Ddeploy.dir=${deploy.dir}"/>
			<arg value="-Ddeploy.dist.module=${deploy.dist.module}"/>
			<arg value="-Dtag=${tag}"/>
    	</java>
    </target>
   	
	<!-- - - - - - - - - - - - - - - - - - 
          target: package                      
         - - - - - - - - - - - - - - - - - -->
    <target name="package" depends="build">
    	<java jar="${startup}" failonerror="true" fork="true" dir="${eclipse.home}/plugins/org.eclipse.pde.build${eclipse.builder.version}/scripts">
    		<arg value="-application" />
    	    <arg value="org.eclipse.ant.core.antRunner" />
    	    <arg value="-buildfile" />
	   		<arg value="${eclipse.home}/plugins/org.eclipse.pde.build${eclipse.builder.version}/scripts/productBuild/productBuild.xml" />
			<arg value="-Dbuilder=${basedir}/ostc"/>
    		<arg value="-DbaseLocation=${eclipse.home}"/>
    		<arg value="-DbuildDirectory=${buildDirectory}"/>
    		<arg value="-Dconfigs=${configs}"/>
       		<arg value="-DbuildType=${buildType}"/>
    		<arg value="-DbuildId=${buildId}"/>
    		<arg value="-Dlibfile=${libfile}"/>
   			<arg value="-Dsource.base=${source.base}"/>
   			<arg value="-Ddeploy.dir=${deploy.dir}"/>
			<arg value="-Ddeploy.dist.module=${deploy.dist.module}"/>
			<arg value="-Dtag=${tag}"/>
    	</java>
    	<mkdir dir="${upload.base.ostc}"/>
    	<copy todir="${upload.base.ostc}">
    		<fileset dir="${buildDirectory}/${buildType}.${buildId}">
    			<include name="**/*"/>
    		</fileset>
    	</copy>
    </target>

	<target name="win32installer">
		<mkdir dir="media"/>
		<copy todir="media" file="${buildDirectory}/plugins/org.openscada.rcp.client/splash.bmp">
		</copy>
		<unzip dest="nsis.build" src="${upload.base.ostc}/${buildId}-win32.win32.x86.zip"/>
		<delete dir="nsis.out"/>
		<mkdir dir="nsis.out"/>
		<exec failonerror="true" executable="makensis">
			<arg value="-DVERSION=${version}"/>
			<arg value="-DRELEASE=${release}"/>
			<arg value="-DDEPLOY=nsis.build"/>
			<arg value="-DMEDIA=media"/>
			<arg value="-DOUT=nsis.out"/>
			<arg value="setup.nsi"/>
		</exec>
		<zip destfile="${upload.base.ostc}/ostc-${version}${release}-win32-setup.zip" basedir="nsis.out">
		</zip>
		<copy todir="${upload.base.ostc}">
			<fileset dir="nsis.out">
				<include name="*.exe"/>
			</fileset>
		</copy>
	</target>

</project>
