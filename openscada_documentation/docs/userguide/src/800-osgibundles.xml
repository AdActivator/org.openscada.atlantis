<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "../../../docbook/dtd/docbookx.dtd" []>

<chapter id="osgibundles"><title><trademark>OSGi</trademark> Bundles</title>
	<para>
	This section describes the different <trademark>OSGi</trademark> bundles available in OpenSCADA.
	</para>
	
<sect1 id="bundle_org.openscada.osgi.equinox.console"><title>org.openscada.osgi.equinox.console</title>
<para>
	The bundle <filename>org.openscada.osgi.equinox.console</filename> provides an implementation of
	an <trademark>Equinox</trademark> console that is accessible using a normal
	<acronym>TCP</acronym> (or Telnet) connection.	
</para>

	<sect2><title>System properties</title>
		<para>
		The following system properties are available:
		</para>
		
		<table><title>System properties of <filename>org.openscada.osgi.equinox.console</filename></title>
				<tgroup cols="4">
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Type</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.osgi.equinox.console.port</entry>
						<entry>Integer</entry>
						<entry>optional</entry>
						<entry>
						The port number the console will bind to. It is important
						that only one console at a time can bind to a port. Different
						instances with different consoles must have different ports
						otherwise the port cannot be opened and the console will
						not be accessible.
						</entry>
					</row>
					
					<row>
						<entry>org.openscada.osgi.equinox.console.timeout.login</entry>
						<entry>Integer</entry>
						<entry>optional</entry>
						<entry>
						The timeout in milliseconds during the login phase
						(before the user is authenticated). If no input is received
						for the specified amount of time the connection is closed by
						the server.
						</entry>
					</row>
					
					<row>
						<entry>org.openscada.osgi.equinox.console.secret</entry>
						<entry>String</entry>
						<entry>optional</entry>
						<entry>
						The <quote>secret</quote> (<abbrev>aka</abbrev> <quote>password</quote>)
						the user has to enter in order to gain access.
						</entry>
					</row>
					
					<row>
						<entry>org.openscada.osgi.equinox.console.timeout</entry>
						<entry>Integer</entry>
						<entry>optional</entry>
						<entry>
						The timeout in milliseconds after the login phase
						(after the user is authenticated). If no input is received
						for the specified amount of time the connection is closed by
						the server.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>

</sect1>

<sect1 id="bundle_org.openscada.ds.storage.file"><title>org.openscada.ds.storage.file</title>
<para>
	The bundle <filename>org.openscada.ds.storage.file</filename> provides an implementation of
	the <acronym>DS</acronym> (Data Store) service based on the file system.
</para>

	<sect2><title>System properties</title>
		<para>
		The following system properties are available:
		</para>
		
		<table><title>System properties of <filename>org.openscada.ds.storage.file</filename></title>
				<tgroup cols="4">
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Type</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.ds.storage.file.root</entry>
						<entry>String</entry>
						<entry>Required</entry>
						<entry>
						The base path to the file system storage where all data will be stored.
						Read and write access is required. If the directory does not exists
						it will be created including all parent directories. The path must not
						point to a file.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>

</sect1>

<sect1 id="bundle_org.openscada.ca.jdbc"><title>org.openscada.ca.jdbc</title>
<para>
	The bundle <filename>org.openscada.ca.jdbc</filename> provides and implementation of
	the <acronym>CA</acronym> (Configuration Administrator) service based on a <acronym>JDBC</acronym>
	data source.
</para>
<para>
	This bundle will, most likely, need a fragment bundle that contains the driver class itself or
	better a reference to the bundle which holds the driver class. Either bundle or
	package reference are possible.
</para>

	<sect2><title>System properties</title>
		<para>
		The following system properties are available:
		</para>
		
		<table><title>System properties of <filename>org.openscada.ca.jdbc</filename></title>
				<tgroup cols="4">
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Type</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.ca.jdbc.schema</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						Name of the schema in the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ca.jdbc.instance</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						Instance name used to differ between different instances using
						the same table. Defaults to <filename>default</filename>.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ca.jdbc.url</entry>
						<entry>String</entry>
						<entry>Required</entry>
						<entry>
						<acronym>URL</acronym> to the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ca.jdbc.username</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						The user name used when connecting with the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ds.storage.jdbc.password</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						The password used when connecting with the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ca.jdbc.password</entry>
						<entry>String</entry>
						<entry>Required</entry>
						<entry>
						The name of the JDBC driver class.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ca.jdbc.fixNull</entry>
						<entry>Boolean</entry>
						<entry>Optional</entry>
						<entry>
						A flag that indicates whether the database stores empty string as <code>null</code>
						which has to be handled differently in that case. (e.g. Oracle required <code>true</code> here).
						Defaults to <filename>false</filename>.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
	<sect2><title>Table structure</title>
		<para>
		The following tables have to be created for the bundle:
		<programlisting language="SQL">
CREATE TABLE OPENSCADA_CA (
 INSTANCE_ID VARCHAR2(255),
 FACTORY_ID VARCHAR(255),
 CONFIGURATION_ID VARCHAR(255),
 CA_KEY VARCHAR(512),
 CA_VALUE VARCHAR(4000),
 CHUNK_SEQ NUMBER(6),
 
 PRIMARY KEY (INSTANCE_ID, FACTORY_ID, CONFIGURATION_ID, CA_KEY, CHUNK_SEQ)
);
		</programlisting>
		</para>
	</sect2>

</sect1>

<sect1 id="bundle_org.openscada.ds.storage.jdbc"><title>org.openscada.ds.storage.jdbc</title>
<para>
	The bundle <filename>org.openscada.ds.storage.jdbc</filename> provides an implementation of
	the <acronym>DS</acronym> (Data Store) service based on a <acronym>JDBC</acronym> data source.
</para>
<para>
	This bundle will, most likely, need a fragment bundle that contains the driver class itself or
	better a reference to the bundle which holds the driver class. Either bundle or
	package reference are possible.
</para>

	<sect2><title>System properties</title>
		<para>
		The following system properties are available:
		</para>
		
		<table><title>System properties of <filename>org.openscada.ds.storage.jdbc</filename></title>
				<tgroup cols="4">
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Type</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.ds.storage.jdbc.schema</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						Name of the schema in the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ds.storage.jdbc.instance</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						Instance name used to differ between different instances using
						the same table. Defaults to <filename>default</filename>.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ds.jdbc.url</entry>
						<entry>String</entry>
						<entry>Required</entry>
						<entry>
						<acronym>URL</acronym> to the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ds.storage.jdbc.username</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						The user name used when connecting with the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ds.storage.jdbc.password</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						The password used when connecting with the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ds.storage.jdbc.driver</entry>
						<entry>String</entry>
						<entry>Required</entry>
						<entry>
						The name of the JDBC driver class.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
	<sect2><title>Table structure</title>
		<para>
		The following tables have to be created for the bundle:
		<programlisting language="SQL">
CREATE TABLE OPENSCADA_DS (
 INSTANCE_ID VARCHAR(255),
 NODE_ID VARCHAR(512),
 DATA  VARCHAR2(4000),
 SEQUENCE_NR NUMBER(6),
 
 PRIMARY KEY (INSTANCE_ID, NODE_ID, SEQUENCE_NR)
);
		</programlisting>
		</para>
	</sect2>

</sect1>

<sect1 id="bundle_org.openscada.ae.server.storage.jdbc"><title>org.openscada.ae.server.storage.jdbc</title>
<para>
	The bundle <filename>org.openscada.ae.server.storage.jdbc</filename> provides an implementation of
	the <acronym>AE</acronym> (Alarms &amp; Events) service based on a <acronym>JDBC</acronym> data source.
</para>
<para>
	This bundle will, most likely, need a fragment bundle that contains the driver class itself or
	better a reference to the bundle which holds the driver class. Either bundle or
	package reference are possible.
</para>

	<sect2><title>System properties</title>
		<para>
		The following system properties are available:
		</para>
		
		<table><title>System properties of <filename>org.openscada.ds.storage.jdbc</filename></title>
				<tgroup cols="4">
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Type</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.ae.server.storage.jdbc.schema</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						Name of the schema in the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ae.server.storage.jdbc.url</entry>
						<entry>String</entry>
						<entry>Required</entry>
						<entry>
						<acronym>URL</acronym> to the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ae.server.storage.jdbc.username</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						The user name used when connecting with the database.
						</entry>
					</row>
					<row>
						<entry>org.openscada.ae.server.storage.jdbc.password</entry>
						<entry>String</entry>
						<entry>Optional</entry>
						<entry>
						The password used when connecting with the database.
						</entry>
					</row>

				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
	<sect2><title>Table structure</title>
		<para>
		The following tables have to be created for the bundle:
		<programlisting language="SQL">
CREATE TABLE OPENSCADA_AE_EVENTS (
   ID CHAR(36),
   SOURCE_TIMESTAMP TIMESTAMP(6),
   ENTRY_TIMESTAMP TIMESTAMP(6),
   MONITOR_TYPE VARCHAR2(32),
   EVENT_TYPE VARCHAR2(32),
   VALUE_TYPE VARCHAR2(32),
   VALUE_STRING VARCHAR2(4000),
   VALUE_INTEGER INTEGER,
   VALUE_DOUBLE DOUBLE PRECISION,
   MESSAGE VARCHAR2(4000),
   MESSAGE_CODE VARCHAR2(255),
   PRIORITY SMALLINT,
   SOURCE  VARCHAR2(255),
   ACTOR_NAME VARCHAR2(128),
   ACTOR_TYPE VARCHAR2(32),
   
   PRIMARY KEY (ID)
);

CREATE TABLE OPENSCADA_AE_EVENTS_ATTR (
   ID CHAR(36),
   "KEY" VARCHAR2(64),
   VARIANT_TYPE VARCHAR2(32),
   VALUE_TYPE VARCHAR2(32),
   VALUE_STRING VARCHAR2(4000),
   VALUE_INTEGER INTEGER,
   VALUE_DOUBLE DOUBLE PRECISION,

   FOREIGN KEY (ID) REFERENCES OPENSCADA_AE_EVENTS (ID) ON DELETE CASCADE
);

CREATE INDEX idx_openscada_ae_1 ON OPENSCADA_AE_EVENTS (SOURCE_TIMESTAMP);
CREATE INDEX idx_openscada_ae_2 ON OPENSCADA_AE_EVENTS (ENTRY_TIMESTAMP);

		</programlisting>
		</para>
	</sect2>

</sect1>

<sect1 id="bundle_org.openscada.sec.provider.script"><title>org.openscada.sec.provider.script</title>
	<para>
	The bundle <filename>org.openscada.sec.provider.script</filename> contains
	and implementation of a authorization provider which is configured using JavaScript
	or other Java scripting compatible with JSR-223.
</para>

	<sect2><title>System properties</title>
		<para>
		No system properties are used by the bundle.
		</para>
	</sect2>
	
	<sect2><title>Exported services</title>
		<para>
		The following services are exported by this bundle:
		</para>
		
		<table><title>Exported services of <filename>org.openscada.sec.provider.script</filename></title>
				<tgroup cols="2">
				<thead>
					<row>
						<entry>Supported interfaces</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.sec.AuthorizationService</entry>
						<entry>
						A script language based authorization provider that evaluates requests
						by iterating through its configured entries as configured using the
						factory <filename>org.openscada.sec.provider.script.factory</filename>.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
	<sect2><title>Configurable services</title>
		<para>
		The following configurable services are provided by this bundle:
		</para>
		
		<table><title>Configurable services of <filename>org.openscada.sec.provider.script</filename></title>
				<tgroup cols="2">
				<thead>
					<row>
						<entry>Factory ID</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>
						org.openscada.sec.provider.script.factory
						</entry>
						<entry>
						A configuration entry used to configure the authorization provider.
						See also <xref linkend="cafactory_org.openscada.sec.provider.script.factory"/>
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
</sect1>

<sect1 id="bundle_org.openscada.sec.provider.dummy"><title>org.openscada.sec.provider.dummy</title>
	<para>
	The bundle <filename>org.openscada.sec.provider.dummy</filename> contains
	and implementation of a authorization and authentication provider which grants
	access to all operations and authorization credentials.
	</para>
	<para>
	The services are registered with lowest possible priority in <trademark>OSGi</trademark>
	so any other service should override the dummy implementation. 
	</para>

	<sect2><title>System properties</title>
		<para>
		No system properties are used by the bundle.
		</para>
	</sect2>
	
	<sect2><title>Exported services</title>
		<para>
		The following services are exported by this bundle:
		</para>
		
		<table><title>Exported services of <filename>org.openscada.sec.provider.script</filename></title>
				<tgroup cols="2">
				<thead>
					<row>
						<entry>Supported interfaces</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.sec.AuthorizationService</entry>
						<entry>
						A dummy authorization service implementation.
						</entry>
					</row>
					<row>
						<entry>org.openscada.sec.AuthenticationService</entry>
						<entry>
						A dummy authentication service implementation.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
</sect1>

<sect1 id="bundle_org.openscada.da.server.osgi.summary"><title>org.openscada.da.server.osgi.summary</title>
	<para>
	The bundle <filename>org.openscada.da.server.osgi.summary</filename> provides summary information
	summarized over all available data sources.
	</para>
	
	<sect2><title>System properties</title>
		<para>
		No system properties are used by the bundle.
		</para>
	</sect2>
	
	
	<sect2><title>Exported services</title>
		<para>
		The following services are exported by this bundle:
		</para>
		
		<table><title>Exported services of <filename>org.openscada.da.server.osgi.summary</filename></title>
				<tgroup cols="2">
				<thead>
					<row>
						<entry>Supported interfaces</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>org.openscada.da.datasource.DataSource</entry>
						<entry>
						Each configured service implements the <interfacename>DataSource</interfacename>
						interface.
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
	<sect2><title>Configurable services</title>
		<para>
		The following configurable services are provided by this bundle:
		</para>
		
		<table><title>Configurable services of <filename>org.openscada.da.server.osgi.summary</filename></title>
				<tgroup cols="2">
				<thead>
					<row>
						<entry>Factory ID</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>
						org.openscada.da.server.osgi.summary.attribute
						</entry>
						<entry>
						A datasource which aggregates all datasources and summarizes by the specifies
						attribute name.
						See also <xref linkend="cafactory_org.openscada.da.server.osgi.summary.attribute"/>
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
</sect1>

<sect1 id="bundle_org.openscada.da.server.osgi.exporter.net"><title>org.openscada.da.server.osgi.exporter.net</title>
	<para>
	The bundle <filename>org.openscada.da.server.osgi.exporter.net</filename> exports
	the first Hive instance registered with <trademark>OSGi</trademark>.
	</para>

	<sect2><title>System properties</title>
		<para>
		The following system properties are available:
		</para>
		
		<table><title>System properties of <filename>org.openscada.osgi.equinox.console</filename></title>
				<tgroup cols="4">
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Type</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>openscada.da.net.exportUri</entry>
						<entry>URI</entry>
						<entry>optional</entry>
						<entry>
						<para>
						The exporter URI that describes the options when exporting the service.
						The URI must start with <quote>da:net:</quote> since this bundle is specifically
						a DA NET exporter.
						</para>
						<para>
						The default value is <uri>da:net://0.0.0.0:1202</uri>
						</para> 
						<para>
						See <xref linkend="connections"/> for more information information
						about possible values.
						</para>
						</entry>
					</row>
				</tbody>
				</tgroup>
		</table>
		
	</sect2>
	
	<sect2><title>Exported services</title>
		<para>
		No services are exported by this bundle.
		</para>
	</sect2>
</sect1>

</chapter>