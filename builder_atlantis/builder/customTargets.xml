<project name="Build specific targets and properties" default="noDefault" xmlns:ivy="antlib:org.apache.ivy.ant">

	<property name="build.root" location=".."/>
		
	<import file="${build.root}/global/lib.xml"/>
	
	<!-- ===================================================================== -->
	<!-- Run a given ${target} on all elements being built -->
	<!-- Add on <ant> task for each top level element being built. -->
	<!-- ===================================================================== -->
	<!--<available property="allElementsFile" file="${builder}/allElements.xml" value="${builder}/allElements.xml"/>-->
	<property name="allElementsFile" location="${eclipse.pdebuild.templates}/headless-build/allElements.xml"/>

	<import file="${allElementsFile}" />
	<target name="allElements">
		<antcall target="allElementsDelegator" />
	</target>
	
	<!-- ===================================================================== -->
	<!-- ===================================================================== -->
	<target name="getBaseComponents" depends="checkLocalBase" unless="skipBase">
		<get src="${eclipseBaseURL}" dest="${buildDirectory}/../temp-base.zip" />
		<unzip dest="${base}" overwrite="true" src="${buildDirectory}/../temp-base.zip" />
	</target>

	<target name="checkLocalBase">
		<available file="${base}" property="skipBase" />
	</target>

	<!-- ===================================================================== -->
	<!-- Check out map files from correct repository -->
	<!-- Replace values for mapsCheckoutTag as desired. -->
	<!-- ===================================================================== -->
	<target name="getMapFiles" depends="checkLocalMaps" unless="skipMaps">
		<echo message="Getting map files"/>
		<property name="mapsCheckoutTag" value="HEAD" />
		<mkdir dir="${buildDirectory}/maps"/>
		<copy todir="${buildDirectory}/maps">
			<fileset dir="${builder}/maps">
				<include name="**/*.map"/>
			</fileset>
		</copy>
	</target>

	<target name="checkLocalMaps">
		<available property="skipMaps" file="${buildDirectory}/maps" />
	</target>

	<target name="tagMapFiles" if="tagMaps">
		<cvs dest="${buildDirectory}/maps/${mapsRoot}" command="tag ${mapsTagTag}" />
	</target>

	<!-- ===================================================================== -->

	<target name="clean" unless="noclean">
		<antcall target="allElements">
			<param name="target" value="cleanElement" />
		</antcall>
	</target>

	<target name="gatherLogs">
		<mkdir dir="${buildDirectory}/${buildLabel}/compilelogs" />
		<antcall target="allElements">
			<param name="target" value="gatherLogs" />
		</antcall>
		<unzip dest="${buildDirectory}/${buildLabel}/compilelogs" overwrite="true">
			<fileset dir="${buildDirectory}/features">
				<include name="**/*.log.zip" />
			</fileset>
		</unzip>
	</target>

	
	<target name="preProcessRepos">	
		<openscada.importAllRepositories/>
  	</target>

	<!-- - - - - - - - - - - - - - - - - - 
          target: postProcessRepos                      
         - - - - - - - - - - - - - - - - - -->
    <target name="postProcessRepos">
    </target>

	
  <!-- ===================================================================== -->
  <!-- Steps to do before setup -->
  <!-- ===================================================================== -->
  <target name="preSetup">
  	<echo message="Building in: ${buildDirectory}"/>
  	<echo message="SkipMaps: ${skipMaps}"/>
  	<echo message="SkipFetch: ${skipFetch}"/>
  	<echo message="Java7: ${JavaSE-1.7}"/>
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after setup but before starting the build proper -->
  <!-- ===================================================================== -->
  <target name="postSetup">
    <antcall target="getBaseComponents" />

    <!-- Eclipse SCADA Core -->
  	
  	<openscada.builder.copyFeature id="org.eclipse.scada.core"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.subscription"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.client"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.client.common"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.server"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.server.common"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.net"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.server.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.client.net"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.server.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.client.ngp"/>
  	
	<openscada.builder.copyPlugin id="org.eclipse.scada.core.server.exporter"/>
  	
  	<!-- Eclipse SCADA DA -->
  	
  	<openscada.builder.copyFeature id="org.eclipse.scada.da"/>
  	<openscada.builder.copyFeature id="org.eclipse.scada.da.sdk"/>

  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.core.common"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.core.server"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.client"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.client.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.common"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.common.osgi"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.net"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.io.common"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.common.io"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.common.memory"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.test"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.sysinfo"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.stock"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.jdbc"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.proxy"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.dave" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.exec" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.arduino"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.modbus"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.osgi.modbus"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.simulation.component" />
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.exporter"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.osgi"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.osgi.summary"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.osgi.testing"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.osgi.exporter.net"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.component.script"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.utils.daemon"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.mapper"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.mapper.osgi"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.master.mapper"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.common.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.client.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.exporter.ngp"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.client.sfp"/>
  	
  	<!-- Eclipse SCADA HD -->
  	
  	<openscada.builder.copyFeature id="org.eclipse.scada.hd"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.client.common"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.common"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.common.item"/>

  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.exporter"/>
	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.common.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.client.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.exporter.ngp"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.net"/>
	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.client.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.exporter.net"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.storage.common"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.storage.hds"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.storage.master.hds"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.storage.slave.hds"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.proxy"/>
  	
	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.exporter.http"/>
	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.exporter.http.server"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.server.importer.hsdb"/>
  	
  	<!-- Eclipse SCADA AE -->
  	
  	<openscada.builder.copyFeature id="org.eclipse.scada.ae"/>
  	  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.filter"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.client.net"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.common.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.client.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.ngp"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.exporter.ngp"/>
  	
	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.connection.provider"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.event"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.event.logger"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.monitor"/>
	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.monitor.common"/>
  	
	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.monitor.script"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.monitor.datasource"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.monitor.datasource.common"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.utils"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.slave.pull"/>
    <openscada.builder.copyPlugin id="org.eclipse.scada.ae.slave.inject"/>
    <openscada.builder.copyPlugin id="org.eclipse.scada.ae.slave.inject.postgres"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.common"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.common.monitor"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.common.event"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.exporter"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.exporter.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.net"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.storage"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.storage.jdbc"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.storage.memory"/>
    <openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.storage.postgres"/>
  		
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.event.proxy"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.monitor.proxy"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.akn.proxy"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.http"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.server.info"/>
  	
  	<!-- Eclipse SCADA CA -->

  	<openscada.builder.copyFeature id="org.eclipse.scada.ca" />
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.client"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.client.ngp"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.connection.provider"/>

  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.servlet" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.servlet.jaxws" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.common" />
	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.console" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.oscar" />
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.file" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.jdbc" />
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.common.ngp" />
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.server" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.server.osgi" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.server.ngp" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ca.server.exporter.ngp" />
  	
  	<!-- SEC stuff for Master -->
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.sec.osgi.manager" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.sec.provider.script" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.sec.provider.jdbc" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.sec.authz.signature" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.sec.audit.log.ae" />
  	
  	<!-- Additional stuff -->
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.client.connection.service"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.ae.client.connection.service"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.client.connection.service"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.client.connection.service"/>
  	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.core.connection.provider"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.connection.provider"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.hd.connection.provider"/>
  		
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.master" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.master.analyzer"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.master.common" />
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.memory"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.sum"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.proxy"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.item"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.script"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.ds"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.formula"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.average"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.movingaverage"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.datasource.constant"/>
  	
  	<openscada.builder.copyFeature id="org.eclipse.scada.atlantis" />
  	<openscada.builder.copyFeature id="org.eclipse.scada.atlantis.sdk" />
  	
  	<!-- editors -->
	
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.common.edit"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.common.editor"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.exec.edit"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.exec.editor"/>
	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.modbus.edit"/>
  	<openscada.builder.copyPlugin id="org.eclipse.scada.da.server.modbus.editor"/>
  	
  	<!-- openSCADA -->
	<openscada.builder.copyPlugin id="org.openscada.da.server.snmp"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.opc"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.opc.edit"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.opc.editor"/>
  	
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before fetching the build elements -->
  <!-- ===================================================================== -->
  <target name="preFetch">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after fetching the build elements -->
  <!-- ===================================================================== -->
  <target name="postFetch">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before generating the build scripts. -->
  <!-- ===================================================================== -->
  <target name="preGenerate">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after generating the build scripts. -->
  <!-- ===================================================================== -->
  <target name="postGenerate">
    <antcall target="clean" />
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before running the build.xmls for the elements being built. -->
  <!-- ===================================================================== -->
  <target name="preProcess">
	<property file="${buildDirectory}/finalFeaturesVersions.properties"/>
  	<echo message="Setting about versions: ${org.eclipse.scada.atlantis}"/>
  	<replace dir="${buildDirectory}/plugins" value="${org.eclipse.scada.atlantis}">
  		<include name="**/about.mappings"/>
  		<replacetoken>@@VERSION@@</replacetoken>
  	</replace>
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after running the build.xmls for the elements being built. -->
  <!-- ===================================================================== -->
  <target name="postProcess">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before running assemble. -->
  <!-- ===================================================================== -->
  <target name="preAssemble">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after  running assemble. -->
  <!-- ===================================================================== -->
  <target name="postAssemble">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before running package. -->
  <!-- ===================================================================== -->
  <target name="prePackage">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after  running package. -->
  <!-- ===================================================================== -->
  <target name="postPackage">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after the build is done. -->
  <!-- ===================================================================== -->
  <target name="postBuild">
    <antcall target="gatherLogs" />
  	<openscada.deploy.repository name="org.eclipse.scada.atlantis.sdk"/>
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do to test the build results -->
  <!-- ===================================================================== -->
  <target name="test">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do to publish the build results -->
  <!-- ===================================================================== -->
  <target name="publish">
  </target>

  <!-- ===================================================================== -->
  <!-- Default target                                                        -->
  <!-- ===================================================================== -->
  <target name="noDefault">
    <echo message="You must specify a target when invoking this file" />
  </target>

</project>
