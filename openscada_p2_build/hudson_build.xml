<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     OpenSCADA P2 (Hudson)
                   
     Jens Reimann                                                                
     ====================================================================== -->
<project name="OpenSCADA P2 (Hudson)" default="default" basedir=".">
    <description>
    	"OpenSCADA P2 (Hudson)"
    </description>

	<property environment="env"/>
	
	<property file="config/build.properties"/>
	<property file="config/local.properties"/>

	<property name="eclipse.pack.dir" value="/home/user/eclipse.download"/>
	
	<property name="publish.type" value="integration"/>
	<property name="publish.id" value="${env.BUILD_ID}" />
	
	<property name="eclipse.download.base" value="http://ftp-stud.fht-esslingen.de/pub/Mirrors/eclipse/eclipse/downloads/drops"/>
	
	<!-- eclipse stuff -->
	
	<property name="eclipse.home.base" value="${env.WORKSPACE}/eclipse"/>
	
	<!-- eclipse.home.dir may not be changed -->
	<property name="eclipse.home.dir" value="${eclipse.home.base}/eclipse"/>
	
	<property name="eclipse.launcher.version" value="_1.0.100.v20080509-1800"/>

	<available file="${eclipse.download}" property="haveEclipseDownload"/>
	<available file="${eclipse.home}" property="haveEclipse"/>
	
	<!-- ================================= 
          target: default              
         ================================= -->
    <target name="default" depends="init,check,build" description="Integration Build">
    </target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: init                      
         - - - - - - - - - - - - - - - - - -->
    <target name="init">
    	<echo message="Build type: ${publish.type} - ${env.RELEASE_VERSION}"/>
    	<echo message="Eclipse Target: ${eclipse.home.dir}"/>
    	
    	<delete dir="${eclipse.home.base}" failonerror="false"/>
    	<provideEclipseDownload.tar dropFile="eclipse-SDK-3.5-linux-gtk.tar.gz" dropId="R-3.5-200906111540"/>
    </target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: check                      
         - - - - - - - - - - - - - - - - - -->
    <target name="check">
    	<fail unless="env.WORKSPACE" message="Please set the environment variable 'WORKSPACE'"/>
    	<mkdir dir="${env.WORKSPACE}"/>
    </target>


	<!-- ================================= 
          target: build              
         ================================= -->
    <target name="build" depends="" description="Build">
        <ant antfile="p2build.xml">
    	</ant>
    </target>
		
	<!-- = = = = = = = = = = = = = = = = =
          macrodef: provideEclipseDownload          
         = = = = = = = = = = = = = = = = = -->
    <macrodef name="provideEclipseDownload.tar">
    	<attribute name="dropId"/>
    	<attribute name="dropFile"/>
    	<attribute name="compression" default="gzip"/>
        <sequential>
        	<mkdir dir="${eclipse.pack.dir}"/>
        	<get usetimestamp="true" dest="${eclipse.pack.dir}/@{dropFile}" src="${eclipse.download.base}/@{dropId}/@{dropFile}" />
        	<untar src="${eclipse.pack.dir}/@{dropFile}" dest="${eclipse.home.base}" compression="@{compression}" />
        </sequential>
    </macrodef>


</project>