<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     OpenSCADA RCP Client (Hudson)
                   
     Jens Reimann                                                                
     ====================================================================== -->
<project name="OpenSCADA RCP Client (Hudson)" default="default" basedir=".">
    <description>
    	"OpenSCADA RCP Client (Hudson)"
    </description>

	<property environment="env"/>
	
	<property file="config/build.properties"/>
	<property name="configs" value="win32,win32,x86&amp;linux,gtk,x86&amp;linux,gtk,x86_64&amp;macosx,carbon,ppc"/>
	<property name="buildType" value="I"/>
	<property name="buildId" value="Integration"/>
	<property name="eclipse.pack.dir" value="/home/user/eclipse.pack"/>
	<property name="publish.type" value="integration"/>
	
	<property name="publish.id" value="${env.BUILD_ID}" />
	
	<!-- eclipse stuff -->
	
	<property name="eclipse.home.base" value="${env.WORKSPACE}"/>
	<property name="eclipse.home" value="${eclipse.home.base}/eclipse"/>
	<property name="eclipse.builder.version" value="_3.4.0.v20080604"/>
	<property name="eclipse.launcher.version" value="_1.0.100.v20080509-1800"/>

	<available file="${eclipse.home}" property="haveEclipse"/>
	
	<!-- ================================= 
          target: default              
         ================================= -->
    <target name="default" depends="init,check,unpackEclipse,build,publish" description="Integration Build">
    </target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: init                      
         - - - - - - - - - - - - - - - - - -->
    <target name="init">
    	<echo message="Build type: ${publish.type} - ${env.RELEASE_VERSION}"/>
    </target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: check                      
         - - - - - - - - - - - - - - - - - -->
    <target name="check">
    	<fail unless="env.WORKSPACE" message="Please set the environment variable 'WORKSPACE'"/>
    	<fail unless="publish.id" message="Please set the environment variable 'publish.id'"/>
    	<fail unless="publish.base" message="Please set the publish target 'publish.base'"/>
    	<mkdir dir="${env.WORKSPACE}"/>
    </target>


	<!-- ================================= 
          target: unpackEclipse              
         ================================= -->
    <target name="unpackEclipse" depends="" description="Unpack the eclipse distribution" unless="haveEclipse">
        <unzip dest="${eclipse.home.base}">
        	<fileset dir="${eclipse.pack.dir}">
        		<include name="*.zip"/>
        	</fileset>
        </unzip>
    	<untar dest="${eclipse.home.base}" compression="gzip">
    		<fileset dir="${eclipse.pack.dir}">
        		<include name="*.tar.gz"/>
        	</fileset>
    	</untar>
    </target>

	
	<!-- ================================= 
          target: build              
         ================================= -->
    <target name="build" depends="" description="Build">
        <ant>
        	<property name="maven.repository" value="${maven.repository}"/>
    	</ant>
    </target>
    
    <!-- ================================= 
          target: publish              
         ================================= -->
    <target name="publish" depends="check" description="Publish">
    	
    	<!-- make latest link -->
    	<delete file="${publish.base}/atlantis/${publish.type}/latest"/>
    	
    	<exec executable="ln">
    		<arg value="-f"/>
    		<arg value="${publish.base}/atlantis/${publish.type}/${publish.id}"/>
    		<arg value="${publish.base}/atlantis/${publish.type}/latest"/>
    	</exec>
    	
    	<mkdir dir="${publish.base}/atlantis/${publish.type}/${publish.id}/ostc"/>
    	<copy todir="${publish.base}/atlantis/${publish.type}/${publish.id}/ostc">
    		<fileset dir="${deploy.base}/deploy/ostc">
    			<include name="*.zip"/>
    		</fileset>
    	</copy>
    	
    	<mkdir dir="${publish.base}/atlantis/${publish.type}/${publish.id}/ide"/>
    	<copy todir="${publish.base}/atlantis/${publish.type}/${publish.id}/ide">
    		<fileset dir="${deploy.base}/deploy/ide">
    			<include name="*.zip"/>
    		</fileset>
    	</copy>
    </target>

	
</project>