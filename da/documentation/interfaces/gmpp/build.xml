<?xml version="1.0" encoding="UTF-8"?>

<project name="openscada_da_doc_gmpp" default="html">

	<property name="prj.dir" value="../.." />
	<property name="fop.dir" value="${prj.dir}/fop" />

	<taskdef name="fop" 
	         classname="org.apache.fop.tools.anttasks.Fop">
	         <classpath>
	            <pathelement location="${fop.dir}/fop.jar"/>
	            <pathelement location="${fop.dir}/avalon-framework-cvs-20020806.jar"/>
	            <pathelement location="${fop.dir}/batik.jar"/>
	         	<pathelement location="${prj.dir}/docbook/extensions/docbook-xsl-xalan25.jar" />
	         </classpath>
	</taskdef>
	
	<target name="clean">
		<delete dir="html" />
		<delete file="main.fo" />
		<delete file="main.pdf" />
	</target>
	
	<target name="all" depends="html, pdf"/>
	<target name="html" depends="clean, render_html"/>
	<target name="pdf" depends="clean, pdf_fo_fop"/>
		
	<target name="render_html" >
		<xslt style="xhtml.xsl" destdir="html"
			defaultexcludes="yes"
			includes="main.xml"
			out=""
			>
			<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
			    <attribute name="http://xml.apache.org/xalan/features/optimize" value="true"/>
            </factory>
			<param name="base.dir" expression=""/>
			<param name="use.extensions" expression="1"/>
			<param name="prj.dir" expression="${prj.dir}"/>
		</xslt>
	</target>
	
	<target name="pdf_fo_fop">
				<xslt style="pdf_fo.xsl"
					in="main.xml"
					out="main.fo"
					>
					<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
					    <attribute name="http://xml.apache.org/xalan/features/optimize" value="true"/>
				    </factory>
					<param name="use.extensions" expression="1"/>
					<param name="fop.extensions" expression="1"/>
					<param name="prj.dir" expression="${prj.dir}"/>
				</xslt>
		</target>
		
	<target name="pdf_with_fop" depends="pdf_fo_fop">
		<fop
			fofile="main.fo"
			outfile="main.pdf"
			/>
	</target>
	
	<target name="deploy" depends="all,deploy_xml,deploy_pdf,deploy_html"/>
	
	<target name="deploy_xml">
		<scp
			keyfile="${keyfile}"
			localFile="main.xml"
			passphrase=""
			todir="${deploy.base}/documentation/specifications/common/gmpp/xml">
		</scp>
	</target>
	
	<target name="deploy_pdf" depends="pdf_with_fop">
			<scp
				keyfile="${keyfile}"
				localFile="main.pdf"
				passphrase=""
				todir="${deploy.base}/documentation/specifications/common/gmpp/pdf">
			</scp>
	</target>
	
	<target name="deploy_html" depends="render_html">
			<zip destfile="main.zip">
				<fileset dir="html"/>
			</zip>
			<scp
				keyfile="${keyfile}"
				passphrase=""
				localFile="main.zip"
				todir="${deploy.base}/documentation/specifications/common/gmpp/html">
			</scp>
			<scp
				keyfile="${keyfile}"
				passphrase=""
				todir="${deploy.base}/documentation/specifications/common/gmpp/html">
				<fileset dir="html"/>
			</scp>
		
	</target>
</project>