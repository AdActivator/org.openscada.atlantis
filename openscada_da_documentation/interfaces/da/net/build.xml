<?xml version="1.0" encoding="UTF-8"?>

<project name="openscada_da_doc_net" default="html">

	<property name="prj.dir" value="../../.." />
	<property name="fop.dir" value="${prj.dir}/fop" />
	<property name="deploy.dir" value="documentation/specifications/da/level0/net"/>
	
	<taskdef name="fop" 
	         classname="org.apache.fop.tools.anttasks.Fop">
	         <classpath>
	            <pathelement location="${fop.dir}/fop.jar"/>
	            <pathelement location="${fop.dir}/avalon-framework-cvs-20020806.jar"/>
	            <pathelement location="${fop.dir}/batik.jar"/>
	         	<pathelement location="${prj.dir}/docbook/extensions/docbook-xsl-xalan25.jar" />
	         </classpath>
	</taskdef>
	
	<target name="all" depends="clean, render_html, render_pdf"/>
	
	<target name="clean">
		<delete dir="html" />
		<delete file="main.fo" />
		<delete file="main.pdf" />
		<delete file="messages_as_db.xml" />
	</target>
	
	<target name="render_html" depends="clean, html"/>
	<target name="html" depends="messages_as_db.xml">
		<xslt style="xhtml.xsl" destdir="html"
			defaultexcludes="yes"
			includes="main.xml"
			out=""
			>
			<!--
			<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
			    <attribute name="http://xml.apache.org/xalan/features/optimize" value="true"/>
            </factory>
            -->
			<param name="base.dir" expression=""/>
			<param name="use.extensions" expression="1"/>
			<param name="prj.dir" expression="${prj.dir}"/>
		</xslt>
	</target>
	
	<target name="pdf_fo" depends="messages_as_db.xml">
				<xslt style="pdf.xsl"
					in="main.xml"
					out="main.fo"
					>
					<!--
					<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
					    <attribute name="http://xml.apache.org/xalan/features/optimize" value="true"/>
				    </factory>
				    -->
					<param name="use.extensions" expression="1"/>
					<param name="fop.extensions" expression="1"/>
					<param name="prj.dir" expression="${prj.dir}"/>
				</xslt>
		</target>
		
	<target name="render_pdf" depends="clean, pdf"/>
	<target name="pdf" depends="pdf_fo">
		<fop
			fofile="main.fo"
			outfile="main.pdf"
			/>
	</target>
	
	<target name="messages_as_db.xml">
		<xslt style="messages2db.xsl"
							in="messages.xml"
							out="messages_as_db.xml"
							>
		</xslt>
	</target>
	

	<target name="deploy" depends="all,deploy_xml,deploy_pdf,deploy_html"/>
	
	<target name="deploy_xml">
		<scp
			keyfile="${keyfile}"
			passphrase=""
			localFile="main.xml"
			todir="${deploy.base}/${deploy.dir}/xml">
		</scp>
		<scp
			keyfile="${keyfile}"
			passphrase=""
			localFile="messages.xml"
			todir="${deploy.base}/${deploy.dir}/xml">
		</scp>
		<scp
			keyfile="${keyfile}"
			passphrase=""
			localFile="messages2db.xsl"
			todir="${deploy.base}/${deploy.dir}/xml">
		</scp>
	</target>
	
	<target name="deploy_pdf" depends="render_pdf">
			<scp
				keyfile="${keyfile}"
				localFile="main.pdf"
				passphrase=""
				todir="${deploy.base}/${deploy.dir}/pdf">
			</scp>
	</target>
	
	<target name="deploy_html" depends="render_html">
			<zip destfile="main.zip">
				<fileset dir="html"/>
			</zip>
			<scp
				keyfile="${keyfile}"
				passphrase=""
				localFile="main.zip"
				todir="${deploy.base}/${deploy.dir}/html">
			</scp>
			<scp
				keyfile="${keyfile}"
				passphrase=""
				todir="${deploy.base}/${deploy.dir}/html">
				<fileset dir="html"/>
			</scp>
		
	</target>
</project>